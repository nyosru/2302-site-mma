function toast(e,t){const r=Swal.mixin({toast:!0,position:"top-right",showConfirmButton:!1,timer:5e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}});r.fire({icon:e,title:t})}function initFormSubmit(){$("form.form-submit").on("submit",onFormSubmit)}function compileData(selector){void 0===selector&&(selector="");let arr={},temp,temp2,key,key2,text="",iCount=0,selectorEach=$("[section"+(selector?'="'+selector+'"':"")+"]");return void 0!==selectorEach&&selectorEach?(selectorEach.each((function(){var c=$(this).attr("section").split(",");void 0!==c.length&&2===c.length?(void 0===arr[c[0]]&&(arr[c[0]]={}),void 0===arr[c[0]][c[1]]&&(arr[c[0]][c[1]]={}),temp=arr[c[0]][c[1]]):(void 0===arr[$(this).attr("section")]&&(arr[$(this).attr("section")]={}),temp=arr[$(this).attr("section")]),$("[section-row]",this).each((function(){if($(this).hasClass("add-tpl"))return;key=$(this).attr("section-row"),key.length||($(this).attr("section-row",iCount),key=iCount),void 0===temp[$(this).attr("section-row")]&&(void 0===key.length||0!==key.length&&c[0]!==key)&&(temp[$(this).attr("section-row")]={});let key1=$(this).attr("section-row");temp2=void 0===key.length||0!==key.length&&c[0]!==key?temp[key1]:temp,$("[section-row-value]",this).each((function(){var key=$(this).attr("section-row-value"),vl=$(this).val();if($(this).attr("section-row-value").length&&null!==vl&&vl.length&&key!==key1||$(this).hasClass("isnull")){var keys=key.split(","),tt="temp2";if(text=selectSectionControl(this),void 0===text)return;for(var i in keys)tt=tt+'["'+keys[i]+'"]',eval("if (typeof "+tt+" === 'undefined') {"+tt+"={};}");eval(tt+" = text;")}else if(key===key1){if(text=selectSectionControl(this),void 0===text||void 0===text)return;temp[key1]=text}})),iCount++}))})),arr):arr}function selectSectionControl(e){var t="";switch($(e).prop("tagName")){case"INPUT":"radio"===$(e).attr("type")&&$(e).is(":checked"),t="checkbox"!==$(e).attr("type")||$(e).is(":checked")?$(e).val():0;break;case"SELECT":t=$(":selected",e).val();break;default:t=void 0!==$(e).data("key")?$(e).attr("data-key"):$(e).hasClass("numeric")?$(e).val().replaceAll(" ",""):$(e).val()}return"number"===$(e).data("type")&&(t=parseInt(t)),"float"===$(e).data("type")&&(t=parseFloat(t)),"bool"===$(e).data("type")&&(t=!!parseInt(t)),t}window.onFormSubmit=function(e){$(".form-overlay").show();let t=$("button",this),r=t.html(),o=$(t).attr("section-submit");console.log(o);let s=compileData(o);t.attr("noprogress")?t.attr("disabled","disabled").addClass("disabled"):t.html('<img class="button-preloader" src="/img/preloader.gif" width="20" height="20" style="padding:0;margin:0;margin-right: 10px;margin-top:3px;" />'+r).attr("disabled","disabled").addClass("disabled"),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content"),"X-H-TOKEN":void 0===e?null:e}});let i=$(this).attr("action");return void 0===i&&(i=$("form.form-submit",this).attr("action")),$.ajax(i,{data:JSON.stringify(s),contentType:"application/json",type:"POST",error:function(e){if($("input[section-row-value]").removeClass("error_value"),"error"in e.responseJSON){let t=[];if("string"!=typeof e.responseJSON.error)for(let r in e.responseJSON.error)$("input[section-row-value="+r+"]").addClass("error_value"),t.push(e.responseJSON.error[r]);else t.push(e.responseJSON.error);toast("error",t.join("<br>"))}t.removeAttr("disabled").html(r),t.removeClass("disabled"),setTimeout((function(){$("input[section-row-value]").removeClass("error_value")}),1e4),$(".form-overlay").hide()},fail:function(e){if($("input[section-row-value]").removeClass("error_value"),"error"in e){let t=[];if("string"!=typeof e.error)for(let r in e.error)$("input[section-row-value="+r+"]").addClass("error_value"),t.push(e.error[r]);else t.push(e.error);toast("error",t.join("<br>"))}t.removeAttr("disabled").html(r),t.removeClass("disabled"),setTimeout((function(){$("input[section-row-value]").removeClass("error_value")}),1e4),$(".form-overlay").hide()},success:function(e){if("redir"in e)"data"in e&&toast(e.success?"success":"error",e.data),location.href=e.redir;else{if($("input[section-row-value]").removeClass("error_value"),!0!==e.success&&"error"in e){let t=[];if("string"!=typeof e.error)for(let r in e.error)$("input[section-row-value="+r+"]").addClass("error_value"),t.push(e.error[r]);else t.push(e.error);toast("error",t.join("<br>"))}else"data"in e&&("object"==typeof e.data?("message"in e.data&&toast("success"in e&&!e.success?"error":"success",e.data.message),"redir"in e.data&&(window.location=e.data.redir)):toast("success"in e&&!e.success?"error":"success",e.data));t.removeAttr("disabled").html(r),t.removeClass("disabled"),setTimeout((function(){$("input[section-row-value]").removeClass("error_value")}),1e4),$(".form-overlay").hide()}}}),!1},$(document).ready((function(){initFormSubmit()}));
